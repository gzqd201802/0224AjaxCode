<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./assets/css/fruits.css">
    <style>
        .container ul > li {
            float: none;
            width: 100%;
            text-align: center;
        }
        .container ul > li img {
            width: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        传智网上水果超市
    </div>
    <div class="container">
        <p>
            <a href="#">水果</a>
            <a href="#">干果</a>
            <a href="#">蔬菜</a>
        </p>
        <ul>
            <li id="detail">
                
            </li>
        </ul>
    </div>
    <div class="footer">
        传智播客 版权所有
    </div>
    <!-- 渲染步骤2.1 准备模板 -->
    <script type="text/template" id="template">
        <img src="{{data.src}}" alt="">
        <p>{{data.name}}</p>
    </script>
    
    <script src="../assets/js/jquery-1.12.2.js"></script>
    <!-- 渲染步骤1 引入模板引擎库 -->
    <script src="../assets/js/template.js"></script>
    <script>
        // 从 url 获取 id 参数
        var searchStr = location.search;
        var searchObj = searchStr2obj(searchStr);
        console.log(searchObj.id);

        // 我们知道需要获取 ID 为 searchObj.id 的水果
        // 所以要发送 ajax 请求
        $.ajax({
            url: 'http://127.0.0.1:3001/getOneFruit',
            type: "get",
            data: {
                id: searchObj.id
            },
            dataType: "json",
            success: function(res) {
                // 渲染步骤 2.2 准备数据
                console.log(res);
                // 渲染步骤 3 生成 html 字符串
                var htmlStr = template('template',res);
                console.log(htmlStr);

                // 渲染步骤 4 渲染页面
                var detailDom = document.querySelector('#detail');
                detailDom.innerHTML = htmlStr;

                

                
            }
        })

        function searchStr2obj(str) {
            str = str.slice(1);
            console.log(str);
            // 以 & 为分隔线 切割字符串到数组
            // 用 split 方法
            searchArr = str.split('&');
            console.log(searchArr);
            // 遍历这个数组，继续从每一项当中 以=为分隔符切割字符串然后生成对象
            var obj = {};
            for (var key in searchArr) {
                //每一项 相当于 searchArr[key]
                // 切割字符串
                var tempArr = searchArr[key].split('=');
                console.log(tempArr);
                // key 是tempArr[0] value 是 tempArr[1]
                // 添加入obj
                obj[tempArr[0]] = tempArr[1];
            }
            return obj;
        }
        
        
        
    </script>
</body>
</html>